<!DOCTYPE html>
<html>

<head>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <style>
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" />
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css" />

    <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        #map_1 {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }

        .leaflet-container {
            font-size: 1rem;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css" />
    <script src="https://cdn.jsdelivr.net/gh/ljagis/leaflet-measure@2.1.7/dist/leaflet-measure.min.js"></script>
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/ljagis/leaflet-measure@2.1.7/dist/leaflet-measure.min.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <style>
        .foliumtooltip {}

        .foliumtooltip table {
            margin: auto;
        }

        .foliumtooltip tr {
            text-align: left;
        }

        .foliumtooltip th {
            padding: 2px;
            padding-right: 8px;
        }
    </style>

</head>

<body>

    <div style="font-weight: bold; font-size: 24px; text-align: center;">Research Map</div>

    <div class="folium-map" id="map_1"></div>

</body>
<script>


    var map_1 = L.map(
        "map_1",
        {
            center: [20.0, 0.0],
            crs: L.CRS.EPSG3857,
            zoom: 2,
            zoomControl: true,
            preferCanvas: false,
            drawExport: false,
            layersControl: true,
        }
    );
    L.control.scale().addTo(map_1);





    var tile_layer_0 = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        { "attribution": "Data by \u0026copy; \u003ca target=\"_blank\" href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca target=\"_blank\" href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 24, "maxZoom": 24, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false }
    ).addTo(map_1);


    L.control.fullscreen(
        { "forceSeparateButton": false, "position": "topleft", "title": "Full Screen", "titleCancel": "Exit Full Screen" }
    ).addTo(map_1);


    var options = {
        position: "topleft",
        draw: {},
        edit: {},
    }
    // FeatureGroup is to store editable layers.
    var drawnItems = new L.featureGroup().addTo(
        map_1
    );
    options.edit.featureGroup = drawnItems;
    var draw_control_a84837bfe93863a74d7e20ca5e9f51ea = new L.Control.Draw(
        options
    ).addTo(map_1);
    map_1.on(L.Draw.Event.CREATED, function (e) {
        var layer = e.layer,
            type = e.layerType;
        var coords = JSON.stringify(layer.toGeoJSON());
        layer.on('click', function () {
            alert(coords);
            console.log(coords);
        });
        drawnItems.addLayer(layer);
    });
    map_1.on('draw:created', function (e) {
        drawnItems.addLayer(e.layer);
    });



    var measure_control_2d6dc905fe08c7e1dec2c221ee84e19e = new L.Control.Measure(
        { "position": "bottomleft", "primaryAreaUnit": "sqmeters", "primaryLengthUnit": "meters", "secondaryAreaUnit": "acres", "secondaryLengthUnit": "miles" });
    map_1.addControl(measure_control_2d6dc905fe08c7e1dec2c221ee84e19e);



    L.Control.geocoder(
        { "collapsed": true, "defaultMarkGeocode": true, "position": "topleft" }
    ).on('markgeocode', function (e) {
        map_1.setView(e.geocode.center, 11);
    }).addTo(map_1);



    map_1.fitBounds(
        [[20, 0], [20, 0]],
        { "maxZoom": 2 }
    );


    var tile_layer_1 = L.tileLayer(
        "https://maps.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",
        { attribution: "Data by &copy; <a target=\"_blank\" href=\"https://maps.gsi.go.jp/xyz/std/{TileMatrix}/{TileCol}/{TileRow}.png\">標準地図</a>", // 修改属性信息
            maxNativeZoom: 18, // 最大本地缩放级别
            maxZoom: 18, // 最大缩放级别
            minZoom: 2, // 最小缩放级别
            noWrap: true, // 是否无限循环
            opacity: 1, // 不透明度
        }
        ).addTo(map_1);
/* 卫星影像
    var tile_layer_1 = L.tileLayer('https://maps.gsi.go.jp/xyz/modis/{z}/{x}/{y}.png', {
    maxZoom: 18, // 最大缩放级别，根据 "z2to8" 设置
}).addTo(map_1); 
*/


    function tgeo_json_1_styler(feature) {
        switch (feature.properties.feature_id) {
            default:
                return { "color": "#3388ff", "fillOpacity": 0, "opacity": 1, "weight": 2 };
        }
    }
    function tgeo_json_1_highlighter(feature) {
        switch (feature.properties.feature_id) {
            default:
                return { "fillOpacity": 0, "weight": 4 };
        }
    }

    function tgeo_json_1_onEachFeature(feature, layer) {
        layer.on({
            mouseout: function (e) {
                if (typeof e.target.setStyle === "function") {
                    tgeo_json_1.resetStyle(e.target);
                }
            },
            mouseover: function (e) {
                if (typeof e.target.setStyle === "function") {
                    const highlightStyle = tgeo_json_1_highlighter(e.target.feature)
                    e.target.setStyle(highlightStyle);
                }
            },
        });
    };
    var tgeo_json_1 = L.geoJson(null, {
        onEachFeature: tgeo_json_1_onEachFeature,

        style: tgeo_json_1_styler,
    });

    // 加载外部geojson
    function tgeo_json_1_add(data) {
        tgeo_json_1
            .addData(data)
            .addTo(map_1);
    }
    fetch('gis/SS.geojson')
            .then(response => response.json())
            .then(data => {
                var geojsonLayer = L.geoJSON(data, {
                    onEachFeature: function (feature, layer) {
                        var customContent = `
                            <h3>${feature.properties.name}</h3>
                            <p>Custom Property: ${feature.properties.customProperty}</p>
                        `;
                        layer.bindTooltip(customContent, { sticky: true });
                    }
                }).addTo(map);
            })
            .catch(error => {
                console.error('Error loading GeoJSON:', error);
            });



    tgeo_json_1.bindTooltip(
        function (layer) {
            let div = L.DomUtil.create('div');

            let handleObject = feature => typeof (feature) == 'object' ? JSON.stringify(feature) : feature;
            let fields = ["id", "name", "color", "feature_id", "coordinates"];
            let aliases = ["id", "name", "color", "feature_id", "coordinates"];
            let table = '<table>' +
                String(
                    fields.map(
                        (v, i) =>
                            `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
                + '</table>';
            div.innerHTML = table;

            return div
        }
        , { "className": "foliumtooltip", "sticky": true });


    var layer_control_12d40de8ae820a06d73d2ddf44afdec4 = {
        base_layers: {
            "OpenStreetMap": tile_layer_0,
        },
        overlays: {
            "地理院標準地図": tile_layer_1,
            "石狩流域": tgeo_json_1,
        },
    };
    L.control.layers(
        layer_control_12d40de8ae820a06d73d2ddf44afdec4.base_layers,
        layer_control_12d40de8ae820a06d73d2ddf44afdec4.overlays,
        { "autoZIndex": true, "collapsed": true, "position": "topright" }
    ).addTo(map_1);

</script>

</html>
